"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes);require("./PieChartSvg.css");var OUTERR=190,INNERR=155,PieChartSvg=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.outerRef=null,r.innerRef=null,r.state={outerDashArray:"0",innerDashArray:"0",innerOffset:"0",tagsAngle:[]},r.colors=e.color.map(function(e){return r.hex2hsl(e)});var a=e.height,n=e.width;return r.CENTERX=n/2,r.CENTERY=a/2,r.NAMESPACE=""+(""+Math.random()).substring(2)+(new Date).valueOf(),r}return _inherits(t,_react.Component),_createClass(t,[{key:"componentDidMount",value:function(){this.init()}},{key:"init",value:function(){var e=this.props.data;if(!e||!e.length)return null;var t=e.reduce(function(e,t){return e+(t.value||0)},0),r="",a=[],n=e.reduce(function(e,n){var i=2*(n.value/t||0)*Math.PI;return a.push((a.length?a[a.length-1]:0)+i),r+=i*INNERR+" ",""+e+i*OUTERR+" "},"").trim(),i=r.trim().split(" ");r=i.splice(1).concat(i).join(" "),a.reverse(),(a=a.map(function(e,t){return t===a.length-1?e/2:(e+a[t+1])/2})).reverse(),this.setState({outerDashArray:n,innerDashArray:r,innerOffset:-i[0],tagsAngle:a})}},{key:"hex2hsl",value:function(e){var t=e.toLowerCase(),r=[];if(t&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){if(4===t.length){for(var a="#",n=1;n<4;n+=1)a+=t.slice(n,n+1).concat(t.slice(n,n+1));t=a}for(var i=1;i<7;i+=2)r.push(parseInt("0x"+t.slice(i,i+2),16));var l=r[0]/255,o=r[1]/255,s=r[2]/255,u=Math.max(l,o,s),c=Math.min(l,o,s),f=(u+c)/2,p=0,h=0;return u!==c&&(p=f<.5?(u-c)/(u+c):(u-c)/(2-u-c),h=l===u?(o-s)/(u-c):o===u?2+(s-l)/(u-c):4+(l-o)/(u-c)),f*=100,p*=100,(h*=60)<0&&(h+=360),[h,p,f]}}},{key:"calculateTagPath",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=OUTERR/2,n=a*Math.sin(Math.PI/4),i="M"+e+","+t+" ";r>=0&&r<Math.PI/4||r>=7*Math.PI/4&&r<2*Math.PI?i+="L"+(e+a)+","+t:r<Math.PI/2?i+="L"+(e+n)+","+(t+n)+" L"+(e+n+a)+","+(t+n):r<3*Math.PI/4?i+="L"+(e-n)+","+(t+n)+" L"+(e-n-a)+","+(t+n):r<5*Math.PI/4?i+="L"+(e-a)+","+t:r<3*Math.PI/2?i+="L"+(e-n)+","+(t-n)+" L"+(e-n-a)+","+(t-n):i+="L"+(e+n)+","+(t-n)+" L"+(e+n+a)+","+(t-n);var l=i.substr(i.lastIndexOf("L")+1).split(","),o=Number(l[0]),s=Number(l[1]),u=!1;return r>=0&&r<Math.PI/2||r>=3*Math.PI/2&&r<2*Math.PI||(u=!0),this.tagStartPoint={x:o,y:s,left:u},i}},{key:"render",value:function(){var e=this,t=this.props,r=t.data,a=t.unit,n=t.infinite,i=t.height,l=t.width,o=this.state.tagsAngle;return _react2.default.createElement("svg",{viewBox:"0 0 "+l+" "+i,version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",className:"gundam-piechart-svg "+(this.props.className||""),style:this.props.style},_react2.default.createElement("defs",null,["outer","inner"].map(function(t,r){var a=e.colors[r%e.colors.length];return _react2.default.createElement("linearGradient",{key:t,x1:"50%",y1:0===r?"0%":"100%",x2:"50%",y2:0===r?"100%":"0%",id:"linearGradient-"+t+"-"+e.NAMESPACE},_react2.default.createElement("stop",{stopColor:"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)",offset:"0%"}),_react2.default.createElement("stop",{stopColor:"hsl("+a[0]+","+a[1]+"%,"+(a[2]-15)+"%)",offset:"100%"}))}),_react2.default.createElement("polygon",{id:"tags-path-1",points:"18.6931818 0 188 0 188 39.8644068 171.977273 56 0 56 0 14.2372881"}),_react2.default.createElement("circle",{id:"tag-line-path-1",r:"3",fill:"#fff"})),_react2.default.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},["outer","inner"].map(function(t,r){var a=e.colors[r%e.colors.length];return _react2.default.createElement("g",{key:t},_react2.default.createElement("circle",{className:"round-circle-line-"+t,stroke:"hsl("+a[0]+","+a[1]+"%,"+(a[2]+15)+"%)"||"#000",strokeWidth:"2",opacity:"0.9",strokeDasharray:"10",cx:e.CENTERX,cy:e.CENTERY,r:0===r?OUTERR:INNERR}),_react2.default.createElement("circle",{className:"round-circle",style:{animationIterationCount:n&&"infinite"},stroke:"url(#linearGradient-"+t+"-"+e.NAMESPACE+")",strokeWidth:"34",cx:e.CENTERX,cy:e.CENTERY,r:0===r?OUTERR:INNERR,ref:function(r){return e[t+"Ref"]=r},strokeDasharray:e.state[t+"DashArray"]||"",strokeDashoffset:e.state[t+"Offset"]||""}))}),r.map(function(t,r){var i=r%2==0?OUTERR:INNERR,l=e.CENTERX+i*Math.cos(o[r]||0),s=e.CENTERY+i*Math.sin(o[r]||0),u=e.colors[r%2%e.colors.length],c="hsl("+u[0]+","+u[1]+"%,"+(u[2]+15)+"%)"||"#000";return _react2.default.createElement("g",{id:"osuv-tags",key:"tag"+r,className:"tag-group-"+r%2},_react2.default.createElement("path",{d:e.calculateTagPath(l,s,o[r]),className:"tag-line-line",style:{animationIterationCount:n&&"infinite"},stroke:c}),_react2.default.createElement("use",{className:"tag-line-circle",style:{animationIterationCount:n&&"infinite"},xlinkHref:"#tag-line-path-1",x:l,y:s}),function(){var r=18*(""+t.value).length+36*(""+(a||"")).length+24*(t.name||"").length+5,i=OUTERR/4/2,l=e.tagStartPoint.x-(e.tagStartPoint.left?r:0),o=e.tagStartPoint.y;return _react2.default.createElement("g",null,_react2.default.createElement("path",{d:"M"+l+","+o+" V"+(o+i)+" H"+(l+r)+" V"+(o-i)+" H"+l+" Z",className:"tag-line-line",style:{animationIterationCount:n&&"infinite"},stroke:c,fillOpacity:"0.5"}),_react2.default.createElement("text",{className:"tag-text",style:{animationIterationCount:n&&"infinite"},fontWeight:"normal",fill:c,textAnchor:"middle",x:l+r/2,y:o+12,fontSize:"36"},t.value?t.value+(a||""):"",_react2.default.createElement("tspan",{fontSize:"24"},t.name||"")))}())})))}}]),t}();exports.default=PieChartSvg,PieChartSvg.propTypes={data:_propTypes2.default.arrayOf(_propTypes2.default.shape({name:_propTypes2.default.string,value:_propTypes2.default.number.isRequired})).isRequired,color:_propTypes2.default.arrayOf(_propTypes2.default.string),unit:_propTypes2.default.string,height:_propTypes2.default.number,width:_propTypes2.default.number},PieChartSvg.defaultProps={data:[],color:["#0073CC"],unit:"",height:580,width:1e3};