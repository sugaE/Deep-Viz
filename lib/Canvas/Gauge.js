"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),Gauge=function(t){function e(t){function i(t){this._width=t.minLength,this._height=t.minLength,this._radius=t.radius,this._outergap=t.outergap,this._innergap=t.innergap,this._value_line_num=t.valueLineNum,this._value_num=t.valueNum,this._value_span=t.valueSpan,this._unite=t.unite,this._context=t.context,this._canvas=t.canvas,this._center_point=t.centerPoint,this.preValue=t.preValue,this.value=t.value}_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.animate=function(){var t=Math.floor(n.gauge.value),e=Math.floor(n.gauge.preValue),i=(t-e)/Math.abs(t-e);e!==t?(e=1*i+e,n.gauge.preValue=e,n.gauge.draw(e),window.requestAnimationFrame?window.requestAnimationFrame(n.animate):n.timeid=setTimeout(n.animate,1)):(n.gauge.draw(n.gauge.value),n.timeid&&clearTimeout(n.timeid))},n.id=Math.random()+"_canvas_gundam",n.gauge=null,i.prototype={constructor:i,drawOuterCircle:function(){this._context.save(),this._context.shadowColor="rgba(0, 0, 0, 0.7)",this._context.shadowOffsetX=0,this._context.shadowOffsetY=0,this._context.shadowBlur=6,this._context.fillStyle="rgba(100, 140, 230, 0.1)",this._context.strokeStyle="rgba(100, 140, 230, 0.9)",this._context.beginPath(),this._context.arc(this._center_point.x,this._center_point.y,this._radius,0,2*Math.PI,!1),this._context.stroke(),this._context.arc(this._center_point.x,this._center_point.y,this._radius-this._outergap,0,2*Math.PI,!0),this._context.fill(),this._context.restore()},drawDegree:function(){this._context.save(),this._context.beginPath(),this._context.fillStyle="rgba(255, 0, 0, 0.2)",this._context.arc(this._center_point.x,this._center_point.y,this._radius-this._outergap,Math.PI/2,0,!0),this._context.arc(this._center_point.x,this._center_point.y,this._radius-this._innergap,0,Math.PI/2,!1),this._context.fill(),this._context.beginPath(),this._context.fillStyle="rgba(0, 128, 0, 0.2)",this._context.arc(this._center_point.x,this._center_point.y,this._radius-this._outergap,Math.PI/2,Math.PI,!1),this._context.arc(this._center_point.x,this._center_point.y,this._radius-this._innergap,Math.PI,Math.PI/2,!0),this._context.fill(),this._context.beginPath(),this._context.fillStyle="rgba(0, 0, 255, 0.2)",this._context.arc(this._center_point.x,this._center_point.y,this._radius-this._outergap,Math.PI,2*Math.PI,!1),this._context.arc(this._center_point.x,this._center_point.y,this._radius-this._innergap,2*Math.PI,Math.PI,!0),this._context.fill();for(var t=this.getValueLineAngle(),e=0,i=0;e<2*Math.PI;e+=t,i+=1){this._context.beginPath(),e<=Math.PI/2?this._context.strokeStyle="red":e>Math.PI/2&&e<=Math.PI?this._context.strokeStyle="green":this._context.strokeStyle="blue";var n=i%2==0?this._center_point.x+(this._radius-this._innergap)*Math.cos(e):this._center_point.x+(this._radius-this._innergap+3)*Math.cos(e),a=i%2==0?this._center_point.y+(this._radius-this._innergap)*Math.sin(e):this._center_point.y+(this._radius-this._innergap+3)*Math.sin(e),s=i%2==0?n+(this._innergap-this._outergap)*Math.cos(e):n+(this._innergap-this._outergap-3)*Math.cos(e),r=i%2==0?a+(this._innergap-this._outergap)*Math.sin(e):a+(this._innergap-this._outergap-3)*Math.sin(e);this._context.moveTo(n,a),this._context.lineTo(s,r),this._context.stroke()}this._context.restore()},getValueLineAngle:function(){return 2*Math.PI/this._value_line_num},getValueAngle:function(){return 2*Math.PI/this._value_num},getMaxValue:function(){return this._value_num*this._value_span},drawNum:function(){this._context.beginPath(),this._context.save(),this._context.shadowColor="rgba(0,0,0,0.8)",this._context.shadowOffsetX=1,this._context.shadowOffsetY=1,this._context.shadowBlur=1,this._context.fillStyle="rgba(0, 0, 230, 0.9)",this._context.font=.08*this._radius+"px Helvetica";for(var t=this.getValueAngle(),e=Math.PI/2,i=0;e<2*Math.PI+Math.PI/2;e+=t,i+=1){var n=this._center_point.x+(this._radius-(this._innergap+.08*this._radius))*Math.cos(e),a=this._center_point.x+(this._radius-(this._innergap+.08*this._radius))*Math.sin(e);i<this._value_num&&this._context.fillText(i*this._value_span,n,a)}this._context.restore()},drawTick:function(t){var e=this.getMaxValue();if("number"==typeof t&&t<=e){var i=this.caculatePoint(t);this._context.save(),this._context.beginPath(),this._context.strokeStyle="yellow",this._context.lineWidth=.015*this._radius,this._context.moveTo(this._center_point.x,this._center_point.y),this._context.lineTo(i.x,i.y),this._context.stroke(),this._context.beginPath(),this._context.fillStyle="rgba(147,210,242,0.6)",this._context.arc(this._center_point.x,this._center_point.y,.05*this._radius,0,2*Math.PI),this._context.fill(),this._context.beginPath(),this._context.arc(i.x,i.y,.025*this._radius,0,2*Math.PI),this._context.fillStyle="rgba(255, 0, 0, 0.6)",this._context.fill(),this._context.restore(),this._context.font=.08*this._radius+"px Helvetica",this._context.fillText("单位:"+this._unite,this._center_point.x,this._center_point.y+.4*this._radius)}},caculatePoint:function(t){var e=t*(this.getValueAngle()/this._value_span)+Math.PI/2;return{x:this._center_point.x+this._radius*Math.cos(e),y:this._center_point.y+this._radius*Math.sin(e)}},draw:function(t){this._context.clearRect(0,0,this._width,this._height),this._context.textAlign="center",this._context.textBaseline="middle",this.drawOuterCircle(),this.drawDegree(),this.drawNum(),this.drawTick(t)}},n.init=function(){var e=document.getElementById(n.id),a=window.getComputedStyle(e.parentNode),s=Math.floor(window.parseInt(a.width)),r=Math.floor(window.parseInt(a.height)),h=Math.min(s,r);e.width=h,e.height=h;var o=h/2*.96,_=.1*o,c=.15*o,u=t.tickMarkNum||60,l=t.valueNum||6,p=t.valueSpan||100,g=t.unit||"km/h",x=e.getContext("2d"),d={x:h/2,y:h/2};n.gauge=new i({minLength:h,radius:o,outergap:_,innergap:c,valueLineNum:u,valueNum:l,valueSpan:p,unite:g,context:x,canvas:e,centerPoint:d,value:t.value,preValue:0}),n.gauge.draw(n.gauge.value)},n}return _inherits(e,_react2.default.Component),_createClass(e,[{key:"componentDidMount",value:function(){this.init()}},{key:"componentWillReceiveProps",value:function(t){var e=this.gauge.value;this.gauge.preValue=e,this.gauge.value=t.value}},{key:"componentDidUpdate",value:function(){this.animate()}},{key:"render",value:function(){return _react2.default.createElement("div",{style:{position:"relative",width:"100%",height:"100%"}},_react2.default.createElement("canvas",{id:this.id}))}}]),e}();exports.default=Gauge;