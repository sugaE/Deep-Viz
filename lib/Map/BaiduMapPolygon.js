"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _objectWithoutProperties(e,t){var o={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(o[r]=e[r]);return o}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_BaiduMapControlBase2=require("./BaiduMapControlBase"),_BaiduMapControlBase3=_interopRequireDefault(_BaiduMapControlBase2),BaiduMapPolygon=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,_BaiduMapControlBase3.default),_createClass(t,[{key:"render",value:function(){function e(){var e=window.BMap,t=new e.Map("map"+b),o=new e.Point(a.lng,a.lat);y(t,f),t.clearOverlays();var r={fillColor:n,strokeColor:n,strokeWeight:1,strokeOpacity:.3,fillOpacity:.3},l=new e.Circle(o,80,{fillColor:n,strokeColor:n,strokeWeight:1,strokeOpacity:.8,fillOpacity:.8});t.addOverlay(l),p.sort(function(e,t){return e.radius-t.radius>0});for(var i=p[p.length-1].radius,d=[.05,.1,.2,.5,1,2,5,10,20,25,50,100,200,500,1e3,2e3],_=0;_<d.length&&!(d[_]>=i);_++);_=_-1<0?0:_-1,t.centerAndZoom(o,18-_),t.setMinZoom(18-c-_<3?3:18-c-_),t.setMaxZoom(18+c-_>18?18:18+c-_);var v=p.map(function(a){var l=new e.Circle(o,1e3*a.radius,r);return t.addOverlay(l),l});if(p.map(function(r,l){var n=void 0,i=void 0,p=void 0;if(0===l)n=o,i=new e.Point(a.lng+.01,a.lat-.01),p=new e.Point(a.lng+.06,a.lat-.01);else{var u=v[l].getBounds().getNorthEast(),d=v[l-1].getBounds().getNorthEast();n=new e.Point((u.lng-d.lng)*Math.sqrt(2)/4+(d.lng-o.lng)*Math.sqrt(2)/2+o.lng,(u.lat-d.lat)*Math.sqrt(2)/4+(d.lat-o.lat)*Math.sqrt(2)/2+o.lat),i=new e.Point(n.lng+.005,n.lat+.005),p=new e.Point(n.lng+.06,n.lat+.005)}var c=new e.Polyline([n,i,p],{strokeColor:s,strokeWeight:1});if(t.addOverlay(c),r.label){var f=new e.Circle(n,50,{fillColor:s,strokeColor:s,strokeWeight:1,strokeOpacity:1,fillOpacity:1}),y=void 0;if("string"==typeof r.label)y=""+r.label;else if("object"===_typeof(r.label)){var b=document.createElement("div");_reactDom2.default.render(r.label,b),y=""+b.innerHTML}var _=new e.Label('<div style="position: absolute; bottom: 0">'+y+"</div>",{position:i,offset:new e.Size(5,0)});_.setStyle({border:"0",backgroundColor:null,color:s}),t.addOverlay(f),t.addOverlay(_)}return""}),u){var g=v[v.length-1].getBounds().getNorthEast(),h=new e.Point(g.lng,2*a.lat-g.lat),m=new e.Point((h.lng-a.lng)*Math.sqrt(2)/4+a.lng/2+h.lng/2,(h.lat-a.lat)*Math.sqrt(2)/4+a.lat/2+h.lat/2),C=m,w=new e.Point(m.lng+.05,m.lat),O=new e.Polyline([m,C,w],{strokeColor:s,strokeWeight:1});t.addOverlay(O);var T=new e.Circle(m,50,{fillColor:s,strokeColor:s,strokeWeight:1,strokeOpacity:1,fillOpacity:1}),M=void 0;if("string"==typeof u)M=""+u;else if("object"===(void 0===u?"undefined":_typeof(u))){var k=document.createElement("div");_reactDom2.default.render(u,k),M=""+k.innerHTML}var P=new e.Label('<div style="position: absolute; bottom: 0">'+M+"</div>",{position:C,offset:new e.Size(5,0)});P.setStyle({border:"0",backgroundColor:null,color:s}),t.addOverlay(T),t.addOverlay(P)}}var t=this.props,o=t.style,r=void 0===o?{}:o,a=t.point,l=t.circleColor,n=void 0===l?"#108EE9":l,i=t.labelColor,s=void 0===i?"#FFFFFF":i,p=t.datas,u=t.outsideLabel,d=t.zoomBias,c=void 0===d?1:d,f=_objectWithoutProperties(t,["style","point","circleColor","labelColor","datas","outsideLabel","zoomBias"]),y=this.initMapControl,b=Math.random();return window["mapload"+b.toString().substr(2)]=e,void 0===window.BMap?function(){var e=document.createElement("script");e.src="http://api.map.baidu.com/api?v=2.0&ak=C4f54f1b740bc62107184968edbb64fb&callback=mapload"+b.toString().substr(2),document.body.appendChild(e)}():setTimeout(e,0),_react2.default.createElement("div",{id:"map"+b,style:_extends({height:"100%",width:"100%"},r)})}}]),t}();BaiduMapPolygon.propTypes={style:_propTypes2.default.object,point:_propTypes2.default.object.isRequired,disableDragging:_propTypes2.default.bool,circleColor:_propTypes2.default.string,labelColor:_propTypes2.default.string,datas:_propTypes2.default.arrayOf(_propTypes2.default.shape({radius:_propTypes2.default.number.isRequired,label:_propTypes2.default.oneOfType([_propTypes2.default.element,_propTypes2.default.string]).isRequired})).isRequired,outsideLabel:_propTypes2.default.oneOfType([_propTypes2.default.element,_propTypes2.default.string]),zoomBias:_propTypes2.default.number},exports.default=BaiduMapPolygon;