"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _objectWithoutProperties(e,t){var o={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(o[r]=e[r]);return o}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},_createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_BaiduMapControlBase2=require("./BaiduMapControlBase"),_BaiduMapControlBase3=_interopRequireDefault(_BaiduMapControlBase2),random=Math.random(),BaiduMapPoint=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,_BaiduMapControlBase3.default),_createClass(t,[{key:"componentDidMount",value:function(){window["mapload"+random.toString().substr(2)]=this.mapload.bind(this),"undefined"==typeof BMap?this.loadScript():this.mapload()}},{key:"loadScript",value:function(){var e=document.createElement("script");e.src="http://api.map.baidu.com/api?v=2.0&ak=C4f54f1b740bc62107184968edbb64fb&callback=mapload"+random.toString().substr(2),document.body.appendChild(e)}},{key:"showMessage",value:function(e,t,o,r){function i(e,t,o){this._point=e,this._msg=t,this.map=o}if(e)return i.prototype=new BMap.Overlay,i.prototype.initialize=function(){var e=this,t=this._div=document.createElement("div");t.style.position="absolute";var o="map_tooltip_"+Math.random();return t.id=o,t.style.zIndex=BMap.Overlay.getZIndex(this._point.lat),setTimeout(function(){var r=_reactDom2.default.render(e._msg(),document.getElementById(o));t.appendChild(r)},0),this.map.getPanes().labelPane.appendChild(t),t},i.prototype.draw=function(){var e=this.map.pointToOverlayPixel(this._point);this._div.style.left=e.x+"px",this._div.style.top=e.y+"px"},function(){var n={position:t,offset:new BMap.Size(-50,-50)};"string"==typeof e?(r.label=new BMap.Label(e,n),r.label.setStyle({color:"black",borderColor:"#FFFFFF",textAlign:"center",fontSize:"12px",height:"30px",width:"100px",lineHeight:"30px",borderRadius:"15px",fontFamily:"微软雅黑",boxShadow:"5px 5px 5px gray"}),o.addOverlay(r.label)):"function"==typeof e&&(r.label=new i(t,e,o),o.addOverlay(r.label))}}},{key:"removeMessage",value:function(e,t){return function(){e.removeOverlay(t.label)}}},{key:"mapload",value:function(){var e=this,t=this.props,o=t.centerPoint,r=t.points,i=t.initZoom,n=void 0===i?5:i,a=_objectWithoutProperties(t,["centerPoint","points","initZoom"]),p=this.initMapControl,s=window.BMap,l=new s.Map("map"+random);p(l,a),l.clearOverlays();var u=new s.Point(o&&o.lng||r[0].location.lng,o&&o.lat||r[0].location.lat);l.centerAndZoom(u,n),Array.isArray(r)&&r.length>0&&r.forEach(function(t){var o=new s.Point(t.location.lng,t.location.lat);if(t.icon)if(t.icon.size){var r=new s.Icon(t.icon.url,new s.Size(t.icon.size.width,t.icon.size.height),t.icon.offsetSize&&{imageOffset:new s.Size(t.icon.offsetSize.width,t.icon.offsetSize.height)});r.imageSize=new s.Size(t.icon.size.width,t.icon.size.height);var i=new s.Marker(o,{icon:r}),n={};i.addEventListener("mouseover",e.showMessage(t.name,o,l,n)),i.addEventListener("mouseout",e.removeMessage(l,n)),l.addOverlay(i)}else console.log("请输入图片大小！");else{var a=function(e,t,o,r){this.map=r,this._point=e,this._color=t,this._radius=o};(a.prototype=new s.Overlay).initialize=function(){var e=this._div=document.createElement("div");return e.style.position="absolute",e.style.borderRadius="50%",e.style.width=this._radius+"px",e.style.height=this._radius+"px",e.style.background=this._color,e.style.zIndex=s.Overlay.getZIndex(this._point.lat),this.map.getPanes().labelPane.appendChild(e),e},a.prototype.draw=function(){var e=this.map.pointToOverlayPixel(this._point);this._div.style.left=e.x-this._radius/2+"px",this._div.style.top=e.y-this._radius/2+"px"};var p=new a(o,t.color||"red",t.radius||12,l);l.addOverlay(p);var u={};p._div.addEventListener("mouseover",e.showMessage(t.name,o,l,u)),p._div.addEventListener("mouseout",e.removeMessage(l,u))}})}},{key:"render",value:function(){var e=this.props.style,t=void 0===e?{}:e;return _react2.default.createElement("div",{id:"map"+random,style:_extends({height:"100%",width:"100%"},t)})}}]),t}();BaiduMapPoint.propTypes={style:_propTypes2.default.object,centerPoint:_propTypes2.default.shape({lat:_propTypes2.default.number.isRequired,lng:_propTypes2.default.number.isRequired}),points:_propTypes2.default.arrayOf(_propTypes2.default.shape({name:_propTypes2.default.oneOfType([_propTypes2.default.func,_propTypes2.default.string]),location:_propTypes2.default.shape({lat:_propTypes2.default.number.isRequired,lng:_propTypes2.default.number.isRequired}).isRequired,icon:_propTypes2.default.shape({url:_propTypes2.default.string.isRequired,size:_propTypes2.default.shape({width:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),height:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string])}),offsetSize:_propTypes2.default.shape({width:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),height:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string])})}),radius:_propTypes2.default.number})).isRequired,initZoom:_propTypes2.default.number},exports.default=BaiduMapPoint;